<!-- XMLBible.html
 - James Skon: original version April 2011
 - Bob Kasper: revised March 2021
 - Benjamin Leskey: revised March 2021
 - Mount Vernon Nazarene University
 -->
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>XML Bible Demo - MVNU</title>
		<script type="text/javascript">
			function setup() {
				if (window.XMLHttpRequest) {
					// Modern browsers (IE7+, Chrome, Firefox, etc.)
					xmlhttp = new XMLHttpRequest();
				}
				else {
					// Ancient browsers (IE5-6)
					xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
				}

				// location of XML Bible files, must be on same web server
				// that hosts this web page to avoid Cross-Domain request restrictions
				biblePath = "/class/csc3004/XMLBible/"
			}

			function getresponse () {
				// read input values from user
				var b = document.getElementById('book').value;
				var c = document.getElementById('chapter').value;
				var v = parseInt(document.getElementById('verse').value);

				// TODO: add code to select a version of the Bible based on user input
				// (only KJV and WEB versions are available with XML files)
				var XMLBook = biblePath + "kjv_by_book/" + b + ".xml";
				xmlhttp.open("GET",XMLBook,false);
				xmlhttp.send();
				xmlDoc = xmlhttp.responseXML;

				var bookInfo = "<h6>Book retrieved from file: " + XMLBook + "</h6>";
				document.all.headArea.innerHTML = "<h1><font color=blue>XML Bible Demo Output</font></h1>" + bookInfo;
				try {
					document.all.responseArea.innerHTML = " ";
					vtext = getVerse(b,c,v);
					document.all.responseArea.innerHTML += "<p>" +vtext+ "</p>";
				}
				catch(error) {
					if (error == "no chapter") {
					document.all.responseArea.innerHTML += "<b><i>No such chapter " +c+ "</i></b>";
					}
					if (error == "no verse") {
						document.all.responseArea.innerHTML += "<b><i>No such verse " +v+ "</i></b>";
					}
				}
			} // end getResponse

			function getVerse(book,chapter,verse) {
				var verseOutput = xmlDoc.getElementsByTagName("book")[0].getAttribute("name");
				var c = xmlDoc.getElementsByTagName("chapter")[chapter-1];
				if (c==null)
					throw "no chapter";
				verseOutput += " ";
				verseOutput += c.getAttribute("number");
				var v = c.getElementsByTagName("verse")[verse-1]
				if (v==null)
					throw "no verse";
				verseOutput += ":";
				verseOutput += v.getAttribute("number");
				verseOutput += " ";
				for (j=0; j < v.childNodes.length; j++) {
					var nodeStr = getNodeString(v.childNodes[j]);
					verseOutput += nodeStr;
				}
				return(verseOutput);
			} // end getVerse

			function getNodeString(node) {
				var result = "";
				if (node.nodeType == 3) { // type 3: text node
					result += node.nodeValue;
					result += " ";
				}
				if (node.nodeType == 1) { // type 1: tag
					if (node.nodeName == "em") {
						result += "<i>";
						result += node.childNodes[0].nodeValue;
						result += "</i> ";
					}
					else if (node.nodeName == "STYLE") {
						result += '<span style="' + node.getAttribute("css") + '">';
						for (n=0; n < node.childNodes.length; n++) {
							var nodeStr = getNodeString(node.childNodes[n]);
							result += nodeStr;
						}
						result += "</span> ";
					}
					else if (node.nodeName=="strongs") {
						if (node.childNodes[0] != null) {
							// show the text of the word that is inside the strong tag
							result += node.childNodes[0].nodeValue;
						}
						// TO DO: use hasAttribute(attributename) to determine
						// if the strongs tag has attributes named hebrew, greek, or number
						// When the attribute exists, add the strong number to the HTML result
						// as the contents of a <sub> tag, which will display it as a subscript
						// after the word.
					}
				}
				return(result);
			} // end getNodeString
		</script>
	</head>

	<body onLoad="setup()">
		<form onsubmit="return false">
			<h1>Bible Search from XML files</h1>
			<table>
				<TR>
					<TD ALIGN=RIGHT VALIGN=TOP>Book Number</TD>
					<TD ALIGN=LEFT VALIGN=TOP><INPUT NAME="book" TYPE="text" MAXLENGTH=2  id=book></TD>
				</TR>
				<TR>
					<TD ALIGN=RIGHT VALIGN=TOP>Chapter</TD>
					<TD ALIGN=LEFT VALIGN=TOP><INPUT NAME="chapter" TYPE="text" MAXLENGTH=3  id=chapter></TD>
				</TR>
				<TR>
					<TD ALIGN=RIGHT VALIGN=TOP>Verse</TD>
					<TD ALIGN=LEFT VALIGN=TOP><INPUT NAME="verse" TYPE="text" MAXLENGTH=3 id=verse></TD>
				</TR>
			</table>
			<p>
				<input type="submit" onclick="javascript: getresponse()" name="submit" value="Submit" />
			</p>
		</form>
		<div id = "headArea">
		</div>
		<div id = "responseArea">
		</div>
	</body>
</html>
